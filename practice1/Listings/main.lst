C51 COMPILER V9.60.0.0   MAIN                                                              02/07/2025 00:32:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          
   4          #define RIGHT 1
   5          #define LEFT -1
   6          static int led_flag = RIGHT;
   7          static unsigned int led_num = 7;
   8          
   9          // 中断部分代码（触摸按键P4.3 / INT2#）
  10          sfr P4    = 0xe8;                   //for 89C5xRC/RD+ series and 90C5xRc/RD+, location at 0E8H
  11          //sfr P4   = 0xc0;                  //for 90C5xAD series, location at 0C0H
  12          sbit INT2 = P4^3;
  13          sbit INT3 = P4^2;
  14          
  15          sfr XICON = 0xc0;                   //for 89C5xRC/RD+ series and 90C5xRc/RD+, location at 0C0H
  16          //sfr XICON = 0xe8;                 //for 90C5xAD series, location at 0E8H
  17          sbit PX3  = XICON^7;
  18          sbit EX3  = XICON^6;
  19          sbit IE3  = XICON^5;
  20          sbit IT3  = XICON^4;
  21          sbit PX2  = XICON^3;
  22          sbit EX2  = XICON^2;
  23          sbit IE2  = XICON^1;
  24          sbit IT2  = XICON^0;
  25          
  26          sfr IPH = 0xB7;
  27          
  28          sbit key = P4^3;
  29          
  30          // 延时函数
  31          void delay_ms(unsigned int xms)   //@12MHz
  32          {
  33   1          unsigned int i, j;
  34   1          for (i = xms; i > 0; i--) {
  35   2              for (j = 124; j > 0; j--) {}
  36   2          }
  37   1      }
  38          
  39          // 外部中断0的回调函数
  40          //void exit0 interrupt 0{
  41          //
  42          //}
  43          
  44          // 外部中断2的回调函数
  45          void exit2() interrupt 6{
  46   1          // 按下的时候，触发中断2，并且读取到key对应的管脚值为0
  47   1          // 按键按下时，灯光切换方向
  48   1          if(key == 0){
  49   2              led_flag = LEFT;
  50   2              delay_ms(10);
  51   2          }
  52   1      }
  53          
  54          // led控制代码
C51 COMPILER V9.60.0.0   MAIN                                                              02/07/2025 00:32:00 PAGE 2   

  55          void open_led(unsigned int num){
  56   1          P2 = 0xFF & ~(1 << num);
  57   1      }
  58          
  59          void main(){
  60   1          IT2 = 1;
  61   1          EX2 = 1;
  62   1          IPH = 0x40;
  63   1          PX2 = 1;
  64   1          EA = 1;
  65   1          while(1){
  66   2              open_led(led_num);
  67   2              delay_ms(1000);
  68   2              if(led_flag == LEFT && key == 1){
  69   3                  led_flag = RIGHT;
  70   3              }
  71   2              led_num += led_flag;
  72   2              if(led_num < 5){
  73   3                  led_num = 7;
  74   3              }else if(led_num >7){
  75   3                  led_num = 5;
  76   3              }
  77   2          }
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    183    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
